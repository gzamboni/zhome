# ZHOME Terraform automation

This repository contains the new terraform modules to configure my personal K8s cluster and all its applications installed.

<!-- markdownlint-disable MD001 -->
### TL;DR

1. [install asdf](https://asdf-vm.com/guide/getting-started.html)
    1. Install the following *asdf* plugins:
        - Python 3.11.3
        - golang 1.19.5
        - terraform 1.4.6
2. [install pre-commit](https://pre-commit.com/#install)
    - Prerequisites:
        - [Python](https://docs.python.org/3/using/index.html)
        - [Pip](https://pip.pypa.io/en/stable/installation/)
3. configure pre-commit: `pre-commit install`
4. install required tools
    - [tflint](https://github.com/terraform-linters/tflint)
    - [tfsec](https://aquasecurity.github.io/tfsec/v1.0.11/)
    - [terraform-docs](https://github.com/terraform-docs/terraform-docs)

## Module Documentation

**Do not manually update README.md**. README.md is automatically generated by pulling in content from other files.

## Terratest

Please include tests to validate your examples/<> root modules, at a minimum. This can be accomplished with usually only slight modifications to the [boilerplate test provided in this template](./test/examples_basic_test.go)

### Configure and run Terratest

1. Install

    [golang](https://go.dev/doc/install) (for macos you can use `brew`)
2. Change directory into the test folder.

    `cd test`
3. Initialize your test

    go mod init github.com/[github org]/[repository]

4. Run tidy

    `go mod tidy`
5. Install Terratest

    `go get github.com/gruntwork-io/terratest/modules/terraform`
6. Run test (You can have multiple test files).
    - Run all tests

        `go test`
    - Run a specific test with a timeout

        `go test -run TestExamplesBasic -timeout 45m`
